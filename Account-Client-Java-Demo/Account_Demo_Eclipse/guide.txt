<h1 id="h1-1573729165084">
    1. 登录华为帐号
</h1>
<h2>
    1.1 场景介绍
</h2>
<p>
    华为帐号是用户访问华为云业务的凭证，拥有华为帐号的用户，可以使用华为云业务，如华为云服务、华为游戏中心、华为应用市场等。通过华为帐号登录服务，开发者可以安全快速的获取用户，共享华为庞大的用户资源。
</p>
<p>
    华为帐号登录是指基于<a href="https://oauth.net/2/" target="_blank">OAuth2.0协议标准</a>和<a href="https://openid.net/connect/" target="_blank">OpenID Connect协议</a>，第三方应用可以获取华为帐号用户身份认证信息(ID Token)或用户的临时授权票据(Authorization Code)，用于用户使用华为帐号安全登录第三方应用。Authorization Code模式仅适用于有自己服务器的应用，ID Token模式同时适合单机应用和有自己服务器的应用。开发者可根据实际情况选择其中一种模式实现。
</p>
<p>
    本章节主要介绍使用ID Token模式登录华为帐号的开发步骤。
</p>
<h2>
    1.2 业务流程
</h2>
<p>
    <img src="https://communityfile-drcn.op.hicloud.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20200117165453.64945935107906184995348784671394:20200214093207:2800:79BEF50A60A45FDB9B39331F2566573A4D02B598FA387DA3FE9BA638524EC357.png"/>
</p>
<p>
    整体流程：
</p>
<p>
    1、用户选择华为帐号登录方式登录应用。
</p>
<p>
    2、应用向HUAWEI Account SDK发起登录请求。
</p>
<p>
    3、华为帐号拉起用户登录授权界面，界面上会根据登录请求中携带的授权域(scope)信息， 显式告知用户需要授权的内容。
</p>
<p>
    4、用户确认允许授权后，华为帐号返回ID Token信息。
</p>
<p>
    5、应用选择使用本地方式验证或华为帐号服务器方式验证ID Token，具体说明参见<a href="#h3-1-3-2">验证ID Token有效性</a>。
</p>
<h2>
    1.3 开发步骤
</h2>
<h3>
    <strong>1.3.1 请求授权获取id token</strong>
</h3>
<p>
    1、展示华为登录方式图标。<br/>应用在登录页面展示华为帐号登录方式的图标，华为登录方式图标规范可参考<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-Guides/account-specification">华为图标规范</a>。
</p>
<p>
    2、调用<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-huaweiidauthparamsHelper#setIdToken">HuaweiIdAuthParamsHelper.setIdToken</a>方法请求授权。
</p>
<pre class="prettyprint linenums prettyprinted" style=""><button class="pre-btn-coyp"><div>
    复制
</div></button>
<ol class="linenums">
    <li class="L0">
        <span class="typ">HuaweiIdAuthParams</span><span class="pln"> authParams </span><span class="pun">=</span><span class="pln"> </span>
    </li>
    <li class="L1">
        <span class="kwd">new </span><span class="typ">HuaweiIdAuthParamsHelper</span><span class="pun">(</span><span class="typ">HuaweiIdAuthParams</span><span class="pun">.</span><span class="pln">DEFAULT_AUTH_REQUEST_PARAM</span><span class="pun">).</span><span class="pln">setIdToken</span><span class="pun">(</span><span class="pun">).</span><span class="pln">createParams</span><span class="pun">();</span>
    </li>
</ol></pre>
<p>
    3、调用<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-huaweiIdauthmanager">HuaweiIdAuthManager</a>的<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-huaweiIdauthmanager#getService">getService</a>方法初始化<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-huaweiIdauthservice">HuaweiIdAuthService</a>对象。
</p>
<pre class="prettyprint linenums prettyprinted" style=""><button class="pre-btn-coyp"><div>
    复制
</div></button>
<ol class="linenums">
    <li class="L0">
        <span class="typ">HuaweiIdAuthService</span><span class="pln"> service </span><span class="pun">=</span><span class="pln"> </span><span class="typ">HuaweiIdAuthManager</span><span class="pun">.</span><span class="pln">getService</span><span class="pun">(</span><span class="typ">MainActivity</span><span class="pun">.</span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> authParams</span><span class="pun">);</span>
    </li>
</ol></pre>
<p>
    4、调用<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-huaweiIdauthservice#getSignInIntent">HuaweiIdAuthService.getSignInIntent</a>方法并拉起华为帐号登录授权页面。
</p>
<pre class="prettyprint linenums prettyprinted" style=""><button class="pre-btn-coyp"><div>
    复制
</div></button>
<ol class="linenums">
    <li class="L0">
        <span class="pln">startActivityForResult</span><span class="pun">(</span><span class="pln">service</span><span class="pun">.</span><span class="pln">getSignInIntent</span><span class="pun">(),</span><span class="pln"> </span><span class="lit">8888</span><span class="pun">);</span>
    </li>
</ol></pre>
<p>
    5、登录授权完成后在页面的onActivityResult中调用<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-huaweiIdauthmanager#parseAuthResultFromIntent">HuaweiIdAuthManager.parseAuthResultFromIntent</a>方法从登录结果中获取华为帐号信息。
</p>
<pre class="prettyprint linenums prettyprinted" style=""><button class="pre-btn-coyp"><div>
    复制
</div></button>
<ol class="linenums">
    <li class="L0">
        <span class="lit">@Override</span>
    </li>
    <li class="L1">
        <span class="pln">protected void onActivityResult</span><span class="pun">(</span><span class="pln">int requestCode</span><span class="pun">,</span><span class="pln"> int resultCode</span><span class="pun">,</span><span class="pln"> </span><span class="lit">@Nullable</span><span class="pln"> </span><span class="typ">Intent</span><span class="pln"> data</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span>
    </li>
    <li class="L2">
        <span class="pln"> &nbsp; &nbsp;</span><span class="pun">//授权登录结果处理，从</span><span class="typ">AuthHuaweiId</span><span class="pun">中获取</span><span class="pln">ID </span><span class="typ">Token</span>
    </li>
    <li class="L3">
        <span class="pln"> &nbsp; &nbsp;super</span><span class="pun">.</span><span class="pln">onActivityResult</span><span class="pun">(</span><span class="pln">requestCode</span><span class="pun">,</span><span class="pln"> resultCode</span><span class="pun">,</span><span class="pln"> data</span><span class="pun">);</span>
    </li>
    <li class="L4">
        <span class="pln"> &nbsp; &nbsp;if </span><span class="pun">(</span><span class="pln">requestCode </span><span class="pun">==</span><span class="pln"> </span><span class="lit">8888</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span>
    </li>
    <li class="L5">
        <span class="pln"> &nbsp; &nbsp;</span><span class="typ">Task</span><span class="pun">&lt;</span><span class="typ">AuthHuaweiId</span><span class="pun">&gt;</span><span class="pln"> authHuaweiIdTask </span><span class="pun">=</span><span class="pln"> </span><span class="typ">HuaweiIdAuthManager</span><span class="pun">.</span><span class="pln">parseAuthResultFromIntent</span><span class="pun">(</span><span class="pln">data</span><span class="pun">);</span>
    </li>
    <li class="L6">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;if </span><span class="pun">(</span><span class="pln">authHuaweiIdTask</span><span class="pun">.</span><span class="pln">isSuccessful</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span>
    </li>
    <li class="L7">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">//登录成功，获取用户的华为帐号信息和</span><span class="pln">ID </span><span class="typ">Token</span>
    </li>
    <li class="L8">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="typ">AuthHuaweiId</span><span class="pln"> huaweiAccount </span><span class="pun">=</span><span class="pln"> authHuaweiIdTask</span><span class="pun">.</span><span class="pln">getResult</span><span class="pun">();</span>
    </li>
    <li class="L9">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="typ">Log</span><span class="pun">.</span><span class="pln">i</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">&quot;idToken:&quot;</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> huaweiAccount</span><span class="pun">.</span><span class="pln">getIdToken</span><span class="pun">());</span>
    </li>
    <li class="L0">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">}</span><span class="pln"> else </span><span class="pun">{</span>
    </li>
    <li class="L1">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">//登录失败，不需要做处理，打点日志方便定位</span>
    </li>
    <li class="L2">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">e</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">&quot;sign in failed : &quot;</span><span class="pln"> </span><span class="pun">+((</span><span class="typ">ApiException</span><span class="pun">)</span><span class="pln">authHuaweiIdTask</span><span class="pun">.</span><span class="pln">getException</span><span class="pun">()).</span><span class="pln">getStatusCode</span><span class="pun">());</span>
    </li>
    <li class="L3">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">}</span>
    </li>
    <li class="L4">
        <span class="pln"> &nbsp; &nbsp;</span><span class="pun">}</span>
    </li>
    <li class="L5">
        <span class="pun">}</span>
    </li>
</ol></pre>
<h3>
    <strong><a id="h3-1-3-2"></a>1.3.2 验证ID Token有效性</strong>
</h3>
<p>
    ●&nbsp;方式1：本地验证
</p>
<p>
    1、从<a href="https://oauth-login.cloud.huawei.com/.well-known/openid-configuration" target="_blank">https://oauth-login.cloud.huawei.com/.well-known/openid-configuration</a>中的jwks_uri字段获取公钥URI，访问公钥URI获取公钥。公钥每天更新一次，应用服务器可以缓存公钥的值。
</p>
<pre class="prettyprint linenums prettyprinted" style=""><button class="pre-btn-coyp" onclick="copyPreText(this)"><div>
    复制
</div></button>
<ol class="linenums">
    <li class="L0">
        <span class="kwd">private</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> getJwks</span><span class="pun">(</span><span class="typ">ICallBack</span><span class="pln"> iCallBack</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span>
    </li>
    <li class="L1">
        <span class="pln"> &nbsp; &nbsp; &nbsp;</span><span class="typ">OkHttpClient</span><span class="pln"> okHttpClient </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">OkHttpClient</span><span class="pun">();</span>
    </li>
    <li class="L2">
        <span class="pln"> &nbsp; &nbsp; &nbsp;</span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Request</span><span class="pln"> request </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Request</span><span class="pun">.</span><span class="typ">Builder</span><span class="pun">()</span>
    </li>
    <li class="L3">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">.</span><span class="pln">url</span><span class="pun">(</span><span class="typ">Constant</span><span class="pun">.</span><span class="pln">CERT_URL</span><span class="pun">)</span>
    </li>
    <li class="L4">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">.</span><span class="pln">build</span><span class="pun">();</span>
    </li>
    <li class="L5">
        <span class="pln"> &nbsp; &nbsp; &nbsp;</span><span class="typ">Call</span><span class="pln"> call </span><span class="pun">=</span><span class="pln"> okHttpClient</span><span class="pun">.</span><span class="pln">newCall</span><span class="pun">(</span><span class="pln">request</span><span class="pun">);</span>
    </li>
    <li class="L6">
        <span class="pln"> &nbsp; &nbsp; &nbsp;call</span><span class="pun">.</span><span class="pln">enqueue</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Callback</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span>
    </li>
    <li class="L7">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="lit">@Override</span>
    </li>
    <li class="L8">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onFailure</span><span class="pun">(</span><span class="typ">Call</span><span class="pln"> call</span><span class="pun">,</span><span class="pln"> </span><span class="typ">IOException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span>
    </li>
    <li class="L9">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="typ">Log</span><span class="pun">.</span><span class="pln">i</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">&quot;Get ID Token failed.&quot;</span><span class="pun">);</span>
    </li>
    <li class="L0">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;iCallBack</span><span class="pun">.</span><span class="pln">onFailed</span><span class="pun">();</span>
    </li>
    <li class="L1">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">}</span>
    </li>
    <li class="L3">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="lit">@Override</span>
    </li>
    <li class="L4">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onResponse</span><span class="pun">(</span><span class="typ">Call</span><span class="pln"> call</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Response</span><span class="pln"> response</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span>
    </li>
    <li class="L5">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">response</span><span class="pun">.</span><span class="pln">isSuccessful</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span>
    </li>
    <li class="L6">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span>
    </li>
    <li class="L7">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="typ">String</span><span class="pln"> res </span><span class="pun">=</span><span class="pln"> response</span><span class="pun">.</span><span class="pln">body</span><span class="pun">().</span><span class="pln">string</span><span class="pun">();</span>
    </li>
    <li class="L8">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="typ">JSONObject</span><span class="pln"> jsonObject </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">JSONObject</span><span class="pun">(</span><span class="pln">res</span><span class="pun">);</span>
    </li>
    <li class="L9">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mJsonArray </span><span class="pun">=</span><span class="pln"> jsonObject</span><span class="pun">.</span><span class="pln">getJSONArray</span><span class="pun">(</span><span class="str">&quot;keys&quot;</span><span class="pun">);</span>
    </li>
    <li class="L0">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;iCallBack</span><span class="pun">.</span><span class="pln">onSuccess</span><span class="pun">();</span>
    </li>
    <li class="L1">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">NullPointerException</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">JSONException</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">IOException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span>
    </li>
    <li class="L2">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="typ">Log</span><span class="pun">.</span><span class="pln">i</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">&quot;parse JsonArray failed.&quot;</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">getMessage</span><span class="pun">());</span>
    </li>
    <li class="L3">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;iCallBack</span><span class="pun">.</span><span class="pln">onFailed</span><span class="pun">();</span>
    </li>
    <li class="L4">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">}</span>
    </li>
    <li class="L5">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">}</span>
    </li>
    <li class="L6">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">}</span>
    </li>
    <li class="L7">
        <span class="pln"> &nbsp; &nbsp; &nbsp;</span><span class="pun">});</span>
    </li>
    <li class="L8">
        <span class="pun">}</span>
    </li>
</ol></pre>
<p>
    2、验证签名。ID Token是JWT格式的，验证ID Token的签名可以采用通用的JWT库，例如<a href="https://jwt.io/" target="_blank">jwt.io</a>。
</p>
<pre class="prettyprint linenums prettyprinted" style=""><button class="pre-btn-coyp" onclick="copyPreText(this)"><div>
    复制
</div></button>
<ol class="linenums">
    <li class="L0">
        <span class="typ">DecodedJWT</span><span class="pln"> decoder </span><span class="pun">=</span><span class="pln"> JWT</span><span class="pun">.</span><span class="pln">decode</span><span class="pun">(</span><span class="pln">idToken</span><span class="pun">);</span>
    </li>
    <li class="L1">
        <span class="typ">Algorithm</span><span class="pln"> algorithm </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Algorithm</span><span class="pun">.</span><span class="pln">RSA256</span><span class="pun">(</span><span class="pln">mRSAPublicKey </span><span class="pun">,</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">);</span>
    </li>
    <li class="L2">
        <span class="typ">JWTVerifier</span><span class="pln"> verifier </span><span class="pun">=</span><span class="pln"> JWT</span><span class="pun">.</span><span class="pln">require</span><span class="pun">(</span><span class="pln">algorithm</span><span class="pun">).</span><span class="pln">build</span><span class="pun">();</span>
    </li>
    <li class="L3">
        <span class="com">// 验证签名</span>
    </li>
    <li class="L4">
        <span class="pln">verifier</span><span class="pun">.</span><span class="pln">verify</span><span class="pun">(</span><span class="pln">decoder</span><span class="pun">);</span>
    </li>
</ol></pre>
<p>
    3、验证ID Token中iss字段的值是否等于“https://accounts.huawei.com”。
</p>
<pre class="prettyprint linenums prettyprinted" style=""><button class="pre-btn-coyp" onclick="copyPreText(this)"><div>
    复制
</div></button>
<ol class="linenums">
    <li class="L0">
        <span class="pln">decoder</span><span class="pun">.</span><span class="pln">getIssuer</span><span class="pun">().</span><span class="pln">equals</span><span class="pun">(</span><span class="pln">ID_TOKEN_ISSUE</span><span class="pun">);</span>
    </li>
</ol></pre>
<p>
    4、验证ID Token中aud字段的值等于应用的client_id。
</p>
<pre class="prettyprint linenums prettyprinted" style=""><button class="pre-btn-coyp" onclick="copyPreText(this)"><div>
    复制
</div></button>
<ol class="linenums">
    <li class="L0">
        <span class="pln">decoder</span><span class="pun">.</span><span class="pln">getAudience</span><span class="pun">().</span><span class="pln">get</span><span class="pun">(</span><span class="lit">0</span><span class="pun">).</span><span class="pln">equals</span><span class="pun">(</span><span class="pln">CLIENT_ID</span><span class="pun">);</span>
    </li>
</ol></pre>
<p>
    5、验证ID Token中的过期时间（exp字段）是否已过期。
</p>
<pre class="prettyprint linenums prettyprinted" style=""><button class="pre-btn-coyp" onclick="copyPreText(this)"><div>
    复制
</div></button>
<ol class="linenums">
    <li class="L0">
        <span class="com">// 过期，会抛出TokenExpiredException异常</span>
    </li>
    <li class="L1">
        <span class="pln">verifier</span><span class="pun">.</span><span class="pln">verify</span><span class="pun">(</span><span class="pln">decoder</span><span class="pun">);</span>
    </li>
</ol></pre>
<p>
    6、如果以上验证均通过，则表示用户ID Token验证通过，应用可使用登录结果中的用户信息。<br/>
</p>
<pre class="prettyprint linenums prettyprinted" style=""><button class="pre-btn-coyp" onclick="copyPreText(this)"><div>
    复制
</div></button>
<ol class="linenums">
    <li class="L0">
        <span class="typ">JSONObject</span><span class="pln"> jsonObject </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">JSONObject</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">String</span><span class="pun">(</span><span class="typ">Base64</span><span class="pun">.</span><span class="pln">decode</span><span class="pun">(</span><span class="pln">decoder</span><span class="pun">.</span><span class="pln">getPayload</span><span class="pun">(),</span><span class="pln"> </span><span class="typ">Base64</span><span class="pun">.</span><span class="pln">URL_SAFE</span><span class="pun">),</span><span class="pln"> DEFAULT_CHARSET</span><span class="pun">));</span>
    </li>
</ol></pre>
<p>
    具体代码可以参考<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-Examples/account-example-v4">客户端示例代码</a>中的IDTokenParser.java。
</p>
<p>
    ●&nbsp;方式2：服务器验证
</p>
<p>
    应用调用<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-verify-id-token">ID Token合法性验证接口</a>向华为帐号服务器发送ID Token验证请求，华为帐号服务器向应用直接返回验证结果。<br/>
</p>
<div class="hw-editor-tip">
    <div class="icon-panel">
        <div class="icon-img icon-img-warn"></div>
    </div>
    <div class="content-panel">
        <div class="title">
            <strong>注意</strong>：
        </div>
        <div class="content">
            由于调用“<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-verify-id-token">ID Token合法性验证接口</a>”会带来耗时，并且受网络状况的影响，所以服务器验证方式只能用于调试目的，在商用环境需要采用本地验证的方式。
        </div>
    </div>
    <div class="link"></div>
</div>
<p>
    请求样例：
</p>
<pre class="prettyprint linenums prettyprinted" style=""><button class="pre-btn-coyp"><div>
    复制
</div></button>
<ol class="linenums">
    <li class="L0">
        <span class="pln">GET </span><span class="pun">/</span><span class="pln">oauth2</span><span class="pun">/</span><span class="pln">v3</span><span class="pun">/</span><span class="pln">tokeninfo</span><span class="pun">?</span><span class="pln"> </span>
    </li>
    <li class="L1">
        <span class="pln">id_token</span><span class="pun">=</span><span class="pln">eyJraWQiOiI2YTI4ODBjNWQ2YTg4Y2M0NjQzZTg4ZWI2ODBlMDUxOTdkNWJlYmQ4NTVhNDdiNzE3NTdmYzFiOTUzMDgwOWNhIiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ</span><span class="pun">.</span><span class="pln">eyJhdF9oYXNoIjoiRHg1V1V3VXpQZWxBTC1TS3VBdldVZyIsInN1YiI6Ik1ERUxhWkd4UTlXaHFIVnFrRVZZcVZYblF5TFhqcDhyVmhmbWxScHg4SjlYclEiLCJob21lX2NvdW50cnlfY29kZSI6IkNOIiwiaXNzIjoiaHR0cHM6Ly9hY2NvdW50cy5odWF3ZWkuY29tIiwiZ2l2ZW5fbmFtZSI6IuiWm</span><span class="pun">-</span><span class="pln">aMr</span><span class="pun">-</span><span class="typ">WNjiIsImxvY2FsZSI6InpoLWNuIiwiZGlzcGxheV9uYW1lIjoi56m65oyH6ZKIMeWPtyIsIm5vbmNlIjoic2FsZmRqb2p1aWV3cnJsa2pkc2Zmc2QiLCJyZWdpc3Rlcl9jb3VudHJ5X2NvZGUiOiJDTiIsImF1ZCI6IjMwMDAzNTIzMyIsImF6cCI6IjMwMDAzNTIzMyIsIm5hbWUiOiLolpvmjK_ljY4iLCJleHAiOjE1NjM4MjM5MDksImlhdCI6MTU2MzgyMDMwOSwiZW1haWwiOiIxNTIyMDI2NjU4MyJ9</span><span class="pun">.</span><span class="pln">cQdyVC7RPl9V6xjPjsRYdKapPb3ZNZPu4FLNMuPZxhoSwENDvvQBRc5_W</span><span class="pun">-</span><span class="pln">kNBmWMh</span><span class="pun">-</span><span class="typ">HxhDwmVPWValubXy</span><span class="pun">-</span><span class="pln">vPey6grUuwDmOQQRYyIsg0nHTBA91LmRIVrWLllpiEbqij_ExsDz2ThCcFoTZ2kXGEoJ2jnBIb17pHuG7USNLTGb7NayBZJrKBl85lo9V8lgMjj3hcMMPVWrF1pRWhWVNy3hOvMSf9n_l309Xn1Rd6lVUaTJtqC0NbpjmLMSj4OGGtvKICIBQlUw46</span><span class="pun">-</span><span class="lit">6rZqxY0DaU8ZrvK8mcWIf9XaHMAZIucOkVdgT3u3sUw1Dy8m8Cr</span><span class="pun">-</span><span class="lit">9zt</span><span class="pln">_wixJMPEm4CMPHA</span><span class="pun">-</span><span class="pln">Q </span>
    </li>
    <li class="L2">
        <span class="typ">Host</span><span class="pun">:</span><span class="pln"> oauth</span><span class="pun">-</span><span class="pln">login</span><span class="pun">.</span><span class="pln">cloud</span><span class="pun">.</span><span class="pln">huawei</span><span class="pun">.</span><span class="pln">com </span>
    </li>
    <li class="L3">
        <span class="typ">Content</span><span class="pun">-</span><span class="typ">Type</span><span class="pun">:</span><span class="pln"> application</span><span class="pun">/</span><span class="pln">x</span><span class="pun">-</span><span class="pln">www</span><span class="pun">-</span><span class="pln">form</span><span class="pun">-</span><span class="pln">urlencoded</span>
    </li>
</ol></pre>
<p>
    返回样例：
</p>
<pre class="prettyprint linenums prettyprinted" style=""><button class="pre-btn-coyp"><div>
    复制
</div></button>
<ol class="linenums">
    <li class="L0">
        <span class="pln">HTTP</span><span class="pun">/</span><span class="lit">1.1</span><span class="pln"> </span><span class="lit">200</span><span class="pln"> OK </span>
    </li>
    <li class="L1">
        <span class="typ">Content</span><span class="pun">-</span><span class="typ">Type</span><span class="pun">:</span><span class="pln"> application</span><span class="pun">/</span><span class="pln">json</span><span class="pun">;</span><span class="pln">charset</span><span class="pun">=</span><span class="pln">UTF</span><span class="pun">-</span><span class="lit">8</span><span class="pln"> </span>
    </li>
    <li class="L2">
        <span class="typ">Cache</span><span class="pun">-</span><span class="typ">Control</span><span class="pun">:</span><span class="pln"> no</span><span class="pun">-</span><span class="pln">store </span>
    </li>
    <li class="L3">
        <span class="typ">Pragma</span><span class="pun">:</span><span class="pln"> no</span><span class="pun">-</span><span class="pln">cache </span>
    </li>
    <li class="L4">
        <span class="pun">{</span><span class="pln"> </span>
    </li>
    <li class="L5">
        <span class="pln"> &nbsp; &nbsp;</span><span class="str">&quot;at_hash&quot;</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;Dx5WUwUzPelAL-SKuAvWUg&quot;</span><span class="pun">,</span><span class="pln"> </span>
    </li>
    <li class="L6">
        <span class="pln"> &nbsp; &nbsp;</span><span class="str">&quot;sub&quot;</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;MDELaZGxQ9WhqHVqkEVYqVXnQyLXjp8rVhfmlRpx8J9XrQ&quot;</span><span class="pun">,</span><span class="pln"> </span>
    </li>
    <li class="L7">
        <span class="pln"> &nbsp; &nbsp;</span><span class="str">&quot;kid&quot;</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;6a2880c5d6a88cc4643e88eb680e05197d5bebd855a47b71757fc1b9530809ca&quot;</span><span class="pun">,</span><span class="pln"> </span>
    </li>
    <li class="L8">
        <span class="pln"> &nbsp; &nbsp;</span><span class="str">&quot;iss&quot;</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;https://accounts.huawei.com&quot;</span><span class="pun">,</span><span class="pln"> </span>
    </li>
    <li class="L9">
        <span class="pln"> &nbsp; &nbsp;</span><span class="str">&quot;typ&quot;</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;JWT&quot;</span><span class="pun">,</span><span class="pln"> </span>
    </li>
    <li class="L0">
        <span class="pln"> &nbsp; &nbsp;</span><span class="str">&quot;given_name&quot;</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;张三&quot;</span><span class="pun">,</span><span class="pln"> </span>
    </li>
    <li class="L1">
        <span class="pln"> &nbsp; &nbsp;</span><span class="str">&quot;locale&quot;</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;zh-cn&quot;</span><span class="pun">,</span><span class="pln"> </span>
    </li>
    <li class="L2">
        <span class="pln"> &nbsp; &nbsp;</span><span class="str">&quot;display_name&quot;</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;Jack&quot;</span><span class="pun">,</span><span class="pln"> </span>
    </li>
    <li class="L3">
        <span class="pln"> &nbsp; &nbsp;</span><span class="str">&quot;nonce&quot;</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;salfdjojuiewrrlkjdsffsd&quot;</span><span class="pun">,</span><span class="pln"> </span>
    </li>
    <li class="L4">
        <span class="pln"> &nbsp; &nbsp;</span><span class="str">&quot;register_country_code&quot;</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;CN&quot;</span><span class="pun">,</span><span class="pln"> </span>
    </li>
    <li class="L5">
        <span class="pln"> &nbsp; &nbsp;</span><span class="str">&quot;aud&quot;</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;300035233&quot;</span><span class="pun">,</span><span class="pln"> </span>
    </li>
    <li class="L6">
        <span class="pln"> &nbsp; &nbsp;</span><span class="str">&quot;azp&quot;</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;300035233&quot;</span><span class="pun">,</span><span class="pln"> </span>
    </li>
    <li class="L7">
        <span class="pln"> &nbsp; &nbsp;</span><span class="str">&quot;name&quot;</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;张三&quot;</span><span class="pun">,</span><span class="pln"> </span>
    </li>
    <li class="L8">
        <span class="pln"> &nbsp; &nbsp;</span><span class="str">&quot;exp&quot;</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1563823909</span><span class="pun">,</span><span class="pln"> </span>
    </li>
    <li class="L9">
        <span class="pln"> &nbsp; &nbsp;</span><span class="str">&quot;iat&quot;</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1563820309</span><span class="pun">,</span><span class="pln"> </span>
    </li>
    <li class="L0">
        <span class="pln"> &nbsp; &nbsp;</span><span class="str">&quot;alg&quot;</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;RS256&quot;</span><span class="pun">,</span><span class="pln"> </span>
    </li>
    <li class="L1">
        <span class="pln"> &nbsp; &nbsp;</span><span class="str">&quot;email&quot;</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;zhangsan@example.com&quot;</span><span class="pln"> </span>
    </li>
    <li class="L2">
        <span class="pun">}</span>
    </li>
</ol></pre>
<h1 id="h1-1573729646190">
    2. 华为帐号登录（Authorization Code）
</h1>
<h2>
    2.1 场景介绍
</h2>
<p>
    华为帐号是用户访问华为云业务的凭证，拥有华为帐号的用户，可以使用华为云业务，如华为云服务、华为游戏中心、华为应用市场等。通过华为帐号登录服务，开发者可以安全快速的获取用户，共享华为庞大的用户资源。
</p>
<p>
    华为帐号登录是指基于<a href="https://oauth.net/2/" target="_blank">OAuth2.0协议标准</a>和<a href="https://openid.net/connect/" target="_blank">OpenID Connect协议</a>，第三方应用可以获取华为帐号用户身份认证信息(ID Token)或用户的临时授权票据(Authorization Code)，用于用户使用华为帐号安全登录第三方应用。Authorization Code模式仅适用于有自己服务器的应用，ID Token模式同时适合单机应用和有自己服务器的应用。开发者可根据实际情况选择其中一种模式实现。
</p>
<p>
    本章节主要介绍使用Authorization Code模式登录华为帐号的开发步骤。
</p>
<h2>
    2.2 业务流程
</h2>
<p>
    <img src="https://communityfile-drcn.op.hicloud.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20200117165508.97529097377753393757553784559548:20200214093207:2800:65C18E16664936527C747E5682400A828FEC1D8B500F78058FF079A3A9F9DEFE.png"/>
</p>
<p>
    整体流程：
</p>
<p>
    1、用户选择华为帐号登录方式登录应用。
</p>
<p>
    2、应用向HUAWEI Account SDK发起登录请求。
</p>
<p>
    3、华为帐号拉起用户登录授权界面，界面上会根据登录请求中携带的授权域(scope)信息， 显式告知用户需要授权的内容。
</p>
<p>
    4、用户确认允许授权后，华为帐号返回Authorization Code信息。
</p>
<p>
    5、应用通过Authorization Code换取Access Token，Refresh Token，ID Token信息。
</p>
<p>
    6、应用服务端可以根据Access Token可以从华为帐号服务器获取用户的openId。
</p>
<p>
    7、如果Access Token或ID Token过期，可以使用Refresh Token获取新的Access Token，ID Token信息。
</p>
<h2>
    2.3 开发步骤
</h2>
<p>
    1、展示华为登录方式图标。<br/>应用在登录页面展示华为帐号登录方式的图标，华为登录方式图标规范可参考<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-Guides/account-specification">华为图标规范</a>。
</p>
<p>
    2、调用<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-huaweiidauthparamsHelper#setAuthorizationCode">HuaweiIdAuthParamsHelper.setAuthorizationCode</a>方法请求授权。
</p>
<pre class="prettyprint linenums prettyprinted" style=""><button class="pre-btn-coyp"><div>
    复制
</div></button>
<ol class="linenums">
    <li class="L0">
        <span class="typ">HuaweiIdAuthParams</span><span class="pln"> authParams </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new </span><span class="typ">HuaweiIdAuthParamsHelper</span><span class="pun">(</span><span class="typ">HuaweiIdAuthParams</span><span class="pun">.</span><span class="pln">DEFAULT_AUTH_REQUEST_PARAM</span><span class="pun">).</span><span class="pln">setAuthorizationCode</span><span class="pun">().</span><span class="pln">createParams</span><span class="pun">();</span>
    </li>
</ol></pre>
<p>
    3、调用<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-huaweiIdauthmanager">HuaweiIdAuthManager</a>的<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-huaweiIdauthmanager#getService">getService</a>方法初始化<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-huaweiIdauthservice">HuaweiIdAuthService</a>对象。
</p>
<pre class="prettyprint linenums prettyprinted" style=""><button class="pre-btn-coyp"><div>
    复制
</div></button>
<ol class="linenums">
    <li class="L0">
        <span class="typ">HuaweiIdAuthService</span><span class="pln"> service </span><span class="pun">=</span><span class="pln"> </span><span class="typ">HuaweiIdAuthManager</span><span class="pun">.</span><span class="pln">getService</span><span class="pun">(</span><span class="typ">MainActivity</span><span class="pun">.</span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> authParams</span><span class="pun">);</span>
    </li>
</ol></pre>
<p>
    4、调用<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-huaweiIdauthservice#getSignInIntent">HuaweiIdAuthService.getSignInIntent</a>方法并拉起华为帐号登录授权页面。
</p>
<pre class="prettyprint linenums prettyprinted" style=""><button class="pre-btn-coyp"><div>
    复制
</div></button>
<ol class="linenums">
    <li class="L0">
        <span class="pln">startActivityForResult</span><span class="pun">(</span><span class="pln">service</span><span class="pun">.</span><span class="pln">getSignInIntent</span><span class="pun">(),</span><span class="pln"> </span><span class="lit">8888</span><span class="pun">);</span>
    </li>
</ol></pre>
<p>
    5、登录授权完成后处理登录结果。
</p>
<pre class="prettyprint linenums prettyprinted" style=""><button class="pre-btn-coyp"><div>
    复制
</div></button>
<ol class="linenums">
    <li class="L0">
        <span class="lit">@Override</span>
    </li>
    <li class="L1">
        <span class="pln">protected void onActivityResult</span><span class="pun">(</span><span class="pln">int requestCode</span><span class="pun">,</span><span class="pln"> int resultCode</span><span class="pun">,</span><span class="pln"> </span><span class="lit">@Nullable</span><span class="pln"> </span><span class="typ">Intent</span><span class="pln"> data</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span>
    </li>
    <li class="L2">
        <span class="pln"> &nbsp;</span><span class="pun">//授权登录结果处理，从</span><span class="typ">AuthHuaweiId</span><span class="pun">中获取</span><span class="typ">Authorization</span><span class="pln"> </span><span class="typ">Code</span>
    </li>
    <li class="L3">
        <span class="pln"> &nbsp;super</span><span class="pun">.</span><span class="pln">onActivityResult</span><span class="pun">(</span><span class="pln">requestCode</span><span class="pun">,</span><span class="pln"> resultCode</span><span class="pun">,</span><span class="pln"> data</span><span class="pun">);</span>
    </li>
    <li class="L4">
        <span class="pln"> &nbsp;if </span><span class="pun">(</span><span class="pln">requestCode </span><span class="pun">==</span><span class="pln"> </span><span class="lit">8888</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span>
    </li>
    <li class="L5">
        <span class="pln"> &nbsp; &nbsp;</span><span class="typ">Task</span><span class="pun">&lt;</span><span class="typ">AuthHuaweiId</span><span class="pun">&gt;</span><span class="pln"> authHuaweiIdTask </span><span class="pun">=</span><span class="pln"> </span><span class="typ">HuaweiIdAuthManager</span><span class="pun">.</span><span class="pln">parseAuthResultFromIntent</span><span class="pun">(</span><span class="pln">data</span><span class="pun">);</span>
    </li>
    <li class="L6">
        <span class="pln"> &nbsp; &nbsp;if </span><span class="pun">(</span><span class="pln">authHuaweiIdTask</span><span class="pun">.</span><span class="pln">isSuccessful</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span>
    </li>
    <li class="L7">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">//登录成功，获取用户的华为帐号信息和</span><span class="typ">Authorization</span><span class="pln"> </span><span class="typ">Code</span>
    </li>
    <li class="L8">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="typ">AuthHuaweiId</span><span class="pln"> huaweiAccount </span><span class="pun">=</span><span class="pln"> authHuaweiIdTask</span><span class="pun">.</span><span class="pln">getResult</span><span class="pun">();</span>
    </li>
    <li class="L9">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="typ">Log</span><span class="pun">.</span><span class="pln">i</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">&quot;Authorization code:&quot;</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> huaweiAccount</span><span class="pun">.</span><span class="pln">getAuthorizationCode</span><span class="pun">());</span>
    </li>
    <li class="L0">
        <span class="pln"> &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"> else </span><span class="pun">{</span>
    </li>
    <li class="L1">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">//登录失败</span>
    </li>
    <li class="L2">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="typ">Log</span><span class="pun">.</span><span class="pln">e</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">&quot;sign in failed : &quot;</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="pun">((</span><span class="typ">ApiException</span><span class="pun">)</span><span class="pln">authHuaweiIdTask</span><span class="pun">.</span><span class="pln">getException</span><span class="pun">()).</span><span class="pln">getStatusCode</span><span class="pun">());</span><span class="pln"> </span>
    </li>
    <li class="L3">
        <span class="pln"> &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span>
    </li>
    <li class="L4">
        <span class="pln"> &nbsp;</span><span class="pun">}</span>
    </li>
    <li class="L5">
        <span class="pun">}</span>
    </li>
</ol></pre>
<p>
    6、登录成功后应用调用<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-obtain-token">Token获取接口</a>向华为帐号服务器请求获取ID Token、Access Token、Refresh Token。该请求为POST请求，需在body体中包含如下参数:
</p>
<table class="layoutFixed">
    <tbody>
        <tr class="firstRow">
            <th style="" width="22.91%">
                参数名
            </th>
            <th style="" width="">
                描述
            </th>
        </tr>
        <tr>
            <td style="" valign="top" width="22.91%">
                <span style="color: rgb(51,51,51);font-family: HuaweiFont-Regular , &quot;Microsoft YaHei&quot; , Arial , PingFangTC-Semibold , &quot;Microsoft YaHei-Regular&quot;;">grant_type</span>
            </td>
            <td style="" valign="top" width="">
                <span style="color: rgb(51,51,51);font-family: HuaweiFont-Regular , &quot;Microsoft YaHei&quot; , Arial , PingFangTC-Semibold , &quot;Microsoft YaHei-Regular&quot;;">authorization_code</span>
            </td>
        </tr>
        <tr>
            <td style="" valign="top" width="22.91%">
                <span style="color: rgb(51,51,51);font-family: HuaweiFont-Regular , &quot;Microsoft YaHei&quot; , Arial , PingFangTC-Semibold , &quot;Microsoft YaHei-Regular&quot;;">code</span>
            </td>
            <td style="" valign="top" width="">
                在前一步获取的授权码
            </td>
        </tr>
        <tr>
            <td style="" valign="top" width="22.91%">
                <span style="color: rgb(51,51,51);font-family: HuaweiFont-Regular , &quot;Microsoft YaHei&quot; , Arial , PingFangTC-Semibold , &quot;Microsoft YaHei-Regular&quot;;">client_id</span>
            </td>
            <td style="" valign="top" width="">
                <span style="color: rgb(51,51,51);font-family: HuaweiFont-Regular , &quot;Microsoft YaHei&quot; , Arial , PingFangTC-Semibold , &quot;Microsoft YaHei-Regular&quot;;">AppGallery Connect中的<span style="color: rgb(51,51,51);font-family: HuaweiFont-Regular , &quot;Microsoft YaHei&quot; , Arial , PingFangTC-Semibold , &quot;Microsoft YaHei-Regular&quot;;">App ID</span></span>
            </td>
        </tr>
        <tr>
            <td style="" valign="top" width="22.91%">
                <span style="color: rgb(51,51,51);font-family: HuaweiFont-Regular , &quot;Microsoft YaHei&quot; , Arial , PingFangTC-Semibold , &quot;Microsoft YaHei-Regular&quot;;">client_secret</span>
            </td>
            <td style="" valign="top" width="">
                <span style="color: rgb(51,51,51);font-family: HuaweiFont-Regular , &quot;Microsoft YaHei&quot; , Arial , PingFangTC-Semibold , &quot;Microsoft YaHei-Regular&quot;;">AppGallery Connect中的<span style="color: rgb(51,51,51);font-family: HuaweiFont-Regular , &quot;Microsoft YaHei&quot; , Arial , PingFangTC-Semibold , &quot;Microsoft YaHei-Regular&quot;;">App secret&nbsp;</span></span>
            </td>
        </tr>
        <tr>
            <td style="" valign="top" width="22.91%">
                <span style="color: rgb(51,51,51);font-family: HuaweiFont-Regular , &quot;Microsoft YaHei&quot; , Arial , PingFangTC-Semibold , &quot;Microsoft YaHei-Regular&quot;;">redirect_uri</span>
            </td>
            <td style="" valign="top" width="">
                <span style="color: rgb(51,51,51);font-family: HuaweiFont-Regular , &quot;Microsoft YaHei&quot; , Arial , PingFangTC-Semibold , &quot;Microsoft YaHei-Regular&quot;;">AppGallery Connect中设置的回调地址</span>
            </td>
        </tr>
    </tbody>
</table>
<p>
    请求样例：
</p>
<pre class="prettyprint linenums prettyprinted" style=""><button class="pre-btn-coyp"><div>
    复制
</div></button>
<ol class="linenums">
    <li class="L0">
        <span class="pln">POST </span><span class="pun">/</span><span class="pln">oauth2</span><span class="pun">/</span><span class="pln">v3</span><span class="pun">/</span><span class="pln">token HTTP</span><span class="pun">/</span><span class="lit">1.1</span>
    </li>
    <li class="L1">
        <span class="typ">Host</span><span class="pun">:</span><span class="pln"> oauth</span><span class="pun">-</span><span class="pln">login</span><span class="pun">.</span><span class="pln">cloud</span><span class="pun">.</span><span class="pln">huawei</span><span class="pun">.</span><span class="pln">com</span>
    </li>
    <li class="L2">
        <span class="typ">Content</span><span class="pun">-</span><span class="typ">Type</span><span class="pun">:</span><span class="pln"> application</span><span class="pun">/</span><span class="pln">x</span><span class="pun">-</span><span class="pln">www</span><span class="pun">-</span><span class="pln">form</span><span class="pun">-</span><span class="pln">urlencoded</span>
    </li>
    <li class="L4">
        <span class="pln">grant_type</span><span class="pun">=</span><span class="pln">authorization_code</span><span class="pun">&amp;</span>
    </li>
    <li class="L5">
        <span class="pln">code</span><span class="pun">=</span><span class="pln">CF3L7XyCVZi52XMdsUzD7Z6ap0</span><span class="pun">/</span><span class="pln">N2qExcNe0AMqTselTtNd1B4DUwTsQ</span><span class="pun">/</span><span class="lit">23FPZasC8yI29v</span><span class="pun">+</span><span class="pln">N2s2jMT</span><span class="pun">/</span><span class="pln">T2MXiuc</span><span class="pun">+</span><span class="lit">178I</span><span class="pun">/</span><span class="pln">sYuWVoTyqwBaDqVW82KCMqaxbeWBguH4hEENxmDSUIE61Qg5R1F074PiS</span><span class="pun">+</span><span class="pln">qJYnbLI2IBqatS37px8pn5qnuq5oX</span><span class="pun">+</span><span class="pln">UX8XN3</span><span class="pun">/</span><span class="pln">w8HLt4GpakW5Dk1v7hGs</span><span class="pun">&amp;</span>
    </li>
    <li class="L6">
        <span class="pln">client_id</span><span class="pun">={</span><span class="pln">app_id</span><span class="pun">}&amp;</span>
    </li>
    <li class="L7">
        <span class="pln">client_secret</span><span class="pun">={</span><span class="pln">app_secret</span><span class="pun">}&amp;</span>
    </li>
    <li class="L8">
        <span class="pln">redirect_uri</span><span class="pun">=</span><span class="pln">https</span><span class="pun">%</span><span class="lit">3A</span><span class="pun">%</span><span class="lit">2F</span><span class="pun">%</span><span class="lit">2F</span><span class="pun">/</span><span class="pln">www</span><span class="pun">.</span><span class="pln">example</span><span class="pun">.</span><span class="pln">com</span><span class="pun">/%</span><span class="lit">2Fredirect</span><span class="pln">_uri</span>
    </li>
</ol></pre>
<p>
    返回样例：
</p>
<pre class="prettyprint linenums prettyprinted" style=""><button class="pre-btn-coyp"><div>
    复制
</div></button>
<ol class="linenums">
    <li class="L0">
        <span class="pln">HTTP</span><span class="pun">/</span><span class="lit">1.1</span><span class="pln"> </span><span class="lit">200</span><span class="pln"> OK</span>
    </li>
    <li class="L1">
        <span class="typ">Content</span><span class="pun">-</span><span class="typ">Type</span><span class="pun">:</span><span class="pln"> application</span><span class="pun">/</span><span class="pln">json</span><span class="pun">;</span><span class="pln">charset</span><span class="pun">=</span><span class="pln">UTF</span><span class="pun">-</span><span class="lit">8</span>
    </li>
    <li class="L2">
        <span class="typ">Cache</span><span class="pun">-</span><span class="typ">Control</span><span class="pun">:</span><span class="pln"> no</span><span class="pun">-</span><span class="pln">store</span>
    </li>
    <li class="L3">
        <span class="typ">Pragma</span><span class="pun">:</span><span class="pln"> no</span><span class="pun">-</span><span class="pln">cache </span>
    </li>
    <li class="L4">
        <span class="pun">{</span><span class="str">&quot;access_token&quot;</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;CFyJ21sNODl16eV9y2vu3CwQk9DBr32BkOcxxgAd7MZUR5th1giyTk5\/kA+QDAyxou+\/5U2zzBRcf3qgLkkFdtbbC+mM3zFV7xj7CCEMHc5Tw92al0Y=&quot;</span><span class="pun">,</span>
    </li>
    <li class="L5">
        <span class="str">&quot;refresh_token&quot;</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;CF13G0sRaGybtYt7SIyeUILNORtTFwMgz4ao5C7j7vtgLPt6ogmXKjdI8RS\/YlyS71z4DyP6kEMnOrRlmNK0KhdOUNWd+qVLLRsEEHkqRIKpuAkPvL8=&quot;</span><span class="pun">,</span><span class="pln"> &nbsp; &nbsp;</span>
    </li>
    <li class="L6">
        <span class="str">&quot;expires_in&quot;</span><span class="pun">:</span><span class="pln"> </span><span class="lit">3600</span><span class="pun">,</span>
    </li>
    <li class="L7">
        <span class="str">&quot;id_token&quot;</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;eyJraWQiOiI3YTNlYjRkNTJmMDdhODM0NDU4MmRhOGQ3MWE1MGQ5MDlmNWM0YmRiZTFkNDQ3MjQ2MDNhZTA2NGM0ZTlkZGYyIiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJhdF9oYXNoIjoiM0hPdFZYOEdMcG1GSDBWRVlSc1BjdyIsImF1ZCI6IjEwMDczNTE2NyIsInN1YiI6Ik1ERTlYaWFoc3MwaWFFNXU2c09PaEY5Mlhvell0Rkt4bUdtbWlhNGtTaEJ3dklLR2ciLCJhenAiOiIxMDA3MzUxNjciLCJpc3MiOiJodHRwczovL2FjY291bnRzLmh1YXdlaS5jb20iLCJuYW1lIjoi6Jab5oyv5Y2OIiwiZXhwIjoxNTczMDQ2NDI4LCJnaXZlbl9uYW1lIjoi6Jab5oyv5Y2OIiwiZGlzcGxheV9uYW1lIjoi5rKh5pyJ562U5qGIIiwiaWF0IjoxNTczMDQyODI4LCJwaWN0dXJlIjoiaHR0cHM6Ly91cGZpbGUtZHJjbi5wbGF0Zm9ybS5oaWNsb3VkLmNvbS9GaWxlU2VydmVyL2ltYWdlL2IuMDI2MDA4NjAwMDIzMjQ3MjUxMS4yMDE5MDgyMDExNTQ0Mi5tbmRjWTZyN2JUT0xNcVdiNVBhZDIzZExWNXh0b1Z2WC4xMDAwLkI0QkUyQTdEM0I3NkFGMzBCMkJDNjlBQ0JFNjg3NDIxMTQwMjhEQzYwREZFOTVCMjM5QkI0QzM2OUQwOUVEMkEuanBnIn0.mqy2C3ZNYEM8FKt8r1LX0VFosJjpqVl7E7mw2N-uEhnmAJq3blBco8fp2TCEyUzi1qFMN7-cjv87mQqCEpgfozyU7xV0VXMGdcd9ZhOxtabZtQGxUXRpIPiK5iysp68d95_QJAf2YZIdA4P_1zU8ZGxH57njIXRUVdQWDB8poeuB9gOc72bufe3DmSkqYD9aKvcibpA44Iln58aj-I9xs-FpcDwE6Y9hTfLGT5vk_5hXs32qwt54kEH1JjKbzZRW7B-OaELJIzzOM49oZKrdkViG6c2Tco1xX1WcKSz298Wckj4suLBAqkam4AprQgoSETC__ORTfy9OHIS1m4_8uQ&quot;</span><span class="pun">,</span>
    </li>
    <li class="L8">
        <span class="str">&quot;scope&quot;</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;openid profile email&quot;</span><span class="pun">,</span>
    </li>
    <li class="L9">
        <span class="str">&quot;token_type&quot;</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;Bearer&quot;</span>
    </li>
    <li class="L0">
        <span class="pun">}</span>
    </li>
</ol></pre>
<p>
    7、由于access token的有效期（目前是60分钟）较短, 当Access Token失效, 或者即将失效时,可以使用Refresh Token通过<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-obtain-token">Token获取接口</a>向华为帐号服务器请求获取新的Access Token。<br/>请求样例：
</p>
<pre class="prettyprint linenums prettyprinted" style=""><button class="pre-btn-coyp"><div>
    复制
</div></button>
<ol class="linenums">
    <li class="L0">
        <span class="pln">POST </span><span class="pun">/</span><span class="pln">oauth2</span><span class="pun">/</span><span class="pln">v3</span><span class="pun">/</span><span class="pln">token HTTP</span><span class="pun">/</span><span class="lit">1.1</span><span class="pln"> </span>
    </li>
    <li class="L1">
        <span class="typ">Host</span><span class="pun">:</span><span class="pln"> oauth</span><span class="pun">-</span><span class="pln">login</span><span class="pun">.</span><span class="pln">cloud</span><span class="pun">.</span><span class="pln">huawei</span><span class="pun">.</span><span class="pln">com </span>
    </li>
    <li class="L2">
        <span class="typ">Content</span><span class="pun">-</span><span class="typ">Type</span><span class="pun">:</span><span class="pln"> application</span><span class="pun">/</span><span class="pln">x</span><span class="pun">-</span><span class="pln">www</span><span class="pun">-</span><span class="pln">form</span><span class="pun">-</span><span class="pln">urlencoded </span>
    </li>
    <li class="L4">
        <span class="pln">grant_type</span><span class="pun">=</span><span class="pln">refresh_token</span><span class="pun">&amp;</span><span class="pln"> </span>
    </li>
    <li class="L5">
        <span class="pln">client_id</span><span class="pun">=</span><span class="lit">12345</span><span class="pun">&amp;</span><span class="pln"> </span>
    </li>
    <li class="L6">
        <span class="pln">client_secret</span><span class="pun">=</span><span class="pln">bKaZ0VE3EYrXaXCdCe3d2k9few</span><span class="pun">&amp;</span><span class="pln"> </span>
    </li>
    <li class="L7">
        <span class="pln">refresh_token</span><span class="pun">=</span><span class="pln">CF2Mm03n0aos9iZZ8nIhfyDtoXy74CXeBi50gVVhMpB0IUzlv9ZwizEvTBhVoF820ZPim0JwNR9j2p1qgEQWnIVYZRlp4T6ezMgekUnsHBkvNev5rd2MdfQMLP</span>
    </li>
</ol></pre>
<p>
    返回样例：
</p>
<pre class="prettyprint linenums prettyprinted" style=""><button class="pre-btn-coyp"><div>
    复制
</div></button>
<ol class="linenums">
    <li class="L0">
        <span class="pln">HTTP</span><span class="pun">/</span><span class="lit">1.1</span><span class="pln"> </span><span class="lit">200</span><span class="pln"> OK </span>
    </li>
    <li class="L1">
        <span class="typ">Content</span><span class="pun">-</span><span class="typ">Type</span><span class="pun">:</span><span class="pln"> application</span><span class="pun">/</span><span class="pln">json</span><span class="pun">;</span><span class="pln">charset</span><span class="pun">=</span><span class="pln">UTF</span><span class="pun">-</span><span class="lit">8</span><span class="pln"> </span>
    </li>
    <li class="L2">
        <span class="typ">Cache</span><span class="pun">-</span><span class="typ">Control</span><span class="pun">:</span><span class="pln"> no</span><span class="pun">-</span><span class="pln">store </span>
    </li>
    <li class="L3">
        <span class="typ">Pragma</span><span class="pun">:</span><span class="pln"> no</span><span class="pun">-</span><span class="pln">cache </span>
    </li>
    <li class="L5">
        <span class="pun">{</span><span class="pln"> </span>
    </li>
    <li class="L6">
        <span class="str">&quot;access_token&quot;</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;CFyJ4J\/l6wuwcFqYOJG4maq2ca8RAV+g0i+mel6qCV5lvqH0PYtW0+BNwfHWg0AqMnW6ZdBvUgs7ijkxMFh1xVP\/B+vQXz3PWsivkKCuL78XtbLt7vs=&quot;</span><span class="pun">,</span><span class="pln"> </span>
    </li>
    <li class="L7">
        <span class="str">&quot;id_token&quot;</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;eyJhbGciOiJSUzI1NiIsImtpZCI6IjExOGRmMjU0YjgzNzE4OWQxYmMyYmU5NjUwYTgyMTEyYzAwZGY1YTQiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJhenAiOiI3ODI0NTY2Njc4OTgtc2M0MzE3Y2l0NGEwMjB0NzdrbGdsbWo1ZjA4YWtnMWIuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJhdWQiOiI3ODI0NTY2Njc4OTgtN2NkNGJpYWRkaGVwNGc4cnZic2VlOGtwcDA5Zm1hNzIuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJzdWIiOiIxMDE3MTIxMzkwMzgwNDE2MDc0MTQiLCJlbWFpbCI6Inh1ZXpoZW5odWF0anVAc2luYS5jb20iLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwicGljdHVyZSI6Imh0dHBzOi8vbGg1Lmdvb2dsZXVzZXJjb250ZW50LmNvbS8tMm9lTTllT09zNTAvQUFBQUFBQUFBQUkvQUFBQUFBQUFBQkkvMVpOSC0xdmxxc3cvczk2LWMvcGhvdG8uanBnIiwiaWF0IjoxNTYxNDUxMTUyLCJleHAiOjE1NjE0NTQ3NTJ9.Eo9IHMkid596jvt1YYzNsRtDq9c9K9dbougkU41Noh7TXNiko86_RuWwHID6k1kDg398AwC3wwH-t2hLcUjgrXPNd9XYU96Jp4-UxdDszP6ywEJgvvBCyTHzsi2auvKt_MnfSrs3qOKfh7noJvXq8AY-Hi3vqSUks5kGqbZKVzCHhBDO3RD9Fs9YHsB6w0XVKZojPOBDaAT_TiijoChn-Q-e8NbSGUx52OgeH-Nw5lOj6JVb_7fb6ucWRzlhiQuzFjklevLVw2pjw1MxKbl1vfRp0X699uZBVjgl9hj1L7LSDObuPzLiXF7ojji5JKYC6zIwAtZQUZ_VUmSk01GDLQ&quot;</span><span class="pun">,</span><span class="pln"> </span>
    </li>
    <li class="L8">
        <span class="str">&quot;expires_in&quot;</span><span class="pun">:</span><span class="pln"> </span><span class="lit">3600</span><span class="pun">,</span><span class="pln"> </span>
    </li>
    <li class="L9">
        <span class="str">&quot;scope&quot;</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;openid profile email&quot;</span><span class="pun">,</span><span class="pln"> </span>
    </li>
    <li class="L0">
        <span class="str">&quot;token_type&quot;</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;Bearer&quot;</span><span class="pln"> </span>
    </li>
    <li class="L1">
        <span class="pun">}</span>
    </li>
</ol></pre>
<h1 id="h1-1573729918116">
    3. 登出华为帐号
</h1>
<h2>
    3.1 场景介绍
</h2>
<p>
    华为帐号登出是指应用向用户提供入口可以退出当前华为帐号登录，用户退出登录后应用需要通知HUAWEI Account SDK清除本地当前已经登录的华为帐号信息。
</p>
<h2>
    3.2 业务流程
</h2>
<p>
    <img src="https://communityfile-drcn.op.hicloud.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20200117165519.49130006237161801040624201879194:20200214093207:2800:A848E783C121771B3DAFC31E10DB0ED1CA9EE295EE0F2C9704946CE085B88E33.png"/>
</p>
<p>
    1、用户在已经登录应用，在应用中执行登出操作。
</p>
<p>
    2、应用调用<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-huaweiIdauthservice#signOut">HuaweiIdAuthService.signOut</a>方法向HUAWEI Account SDK请求退出华为帐号。
</p>
<p>
    3、HUAWEI Account SDK清理华为帐号登录信息后向应用返回登出结果。
</p>
<h3>
    3.3 开发步骤
</h3>
<p>
    华为帐号登出功能涉及应用的关键开发步骤如下：
</p>
<p>
    1、使用华为帐号登录授权时创建的<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-huaweiIdauthservice">HuaweiIdAuthService</a>实例调用<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-huaweiIdauthservice#signOut">signOut</a>接口。
</p>
<pre class="prettyprint linenums prettyprinted" style=""><button class="pre-btn-coyp"><div>
    复制
</div></button>
<ol class="linenums">
    <li class="L0">
        <span class="pun">//</span><span class="pln">service</span><span class="pun">为登录授权时使用</span><span class="pln">getService</span><span class="pun">方法生成的</span><span class="typ">HuaweiIdAuthService</span><span class="pun">实例</span>
    </li>
    <li class="L1">
        <span class="typ">Task</span><span class="pun">&lt;</span><span class="typ">Void</span><span class="pun">&gt;</span><span class="pln"> signOutTask </span><span class="pun">=</span><span class="pln"> service</span><span class="pun">.</span><span class="pln">signOut</span><span class="pun">();</span>
    </li>
</ol></pre>
<p>
    2、signOut完成后的处理。
</p>
<pre class="prettyprint linenums prettyprinted" style=""><button class="pre-btn-coyp"><div>
    复制
</div></button>
<ol class="linenums">
    <li class="L0">
        <span class="pln">signOutTask</span><span class="pun">.</span><span class="pln">addOnCompleteListener</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">OnCompleteListener</span><span class="pun">&lt;</span><span class="typ">Void</span><span class="pun">&gt;()</span><span class="pln"> </span><span class="pun">{</span>
    </li>
    <li class="L1">
        <span class="pln"> &nbsp; &nbsp;</span><span class="lit">@Override</span><span class="pln"> &nbsp; </span>
    </li>
    <li class="L2">
        <span class="pln"> &nbsp; &nbsp;</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onComplete</span><span class="pun">(</span><span class="typ">Task</span><span class="pun">&lt;</span><span class="typ">Void</span><span class="pun">&gt;</span><span class="pln"> task</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> &nbsp; &nbsp; &nbsp;</span>
    </li>
    <li class="L3">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">//完成登出后的处理 &nbsp; &nbsp; &nbsp; </span>
    </li>
    <li class="L4">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="typ">Log</span><span class="pun">.</span><span class="pln">i</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">&quot;signOut complete&quot;</span><span class="pun">);</span>
    </li>
    <li class="L5">
        <span class="pln"> &nbsp; &nbsp;</span><span class="pun">}</span>
    </li>
    <li class="L6">
        <span class="pun">});</span>
    </li>
</ol></pre>
<h1 id="h1-1573730049834">
    4. 静默登录
</h1>
<h2>
    4.1 场景介绍
</h2>
<p>
    用户首次使用华为帐号登录应用后，再次登录时，无需重复授权。
</p>
<h2>
    4.2 业务流程
</h2>
<p>
    <img src="https://communityfile-drcn.op.hicloud.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20200117165533.44798224574348254846012891589620:20200214093207:2800:647000C8C9D568A7D85B697F54B5A608A2D92D4F6B04C0FC0245A56A2C701B48.png"/>
</p>
<p>
    1、用户进行了触发静默登录的场景，根据应用实际场景由开发者自行设定。
</p>
<p>
    2、应用调用<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-huaweiidauthparamsHelper">HuaweiIdAuthParamsHelper</a>的默认构造方法配置鉴权参数。
</p>
<p>
    3、HUAWEI Account SDK向应用返回包含授权参数的<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-huaweiidauthparams">HuaweiIdAuthParams</a>对象。
</p>
<p>
    4、应用调用<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-huaweiIdauthmanager">HuaweiIdAuthManager</a>的<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-huaweiIdauthmanager#getService">getService</a>方法初始化<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-huaweiIdauthservice">HuaweiIdAuthService</a>实例。
</p>
<p>
    5、HUAWEI Account SDK向应用返回<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-huaweiIdauthservice">HuaweiIdAuthService</a>对象。
</p>
<p>
    6、应用调用<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-huaweiIdauthservice#silentSignIn">HuaweiIdAuthService.silentSignIn</a>方法向HUAWEI Account SDK发起静默登录请求。
</p>
<p>
    7、HUAWEI Account SDK检查用户是否符合静默登录的授权，并向应用返回授权结果。
</p>
<p>
    8、应用根据授权结果自行确定后续处理。
</p>
<p></p>
<h2>
    4.3 开发步骤
</h2>
<p>
    静默登录功能涉及应用的关键开发步骤如下：
</p>
<p>
    1、调用<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-huaweiidauthparamsHelper">HuaweiIdAuthParamsHelper</a>的默认构造方法配置授权参数。
</p>
<pre class="prettyprint linenums prettyprinted" style=""><button class="pre-btn-coyp"><div>
    复制
</div></button>
<ol class="linenums">
    <li class="L0">
        <span class="typ">HuaweiIdAuthParams</span><span class="pln"> authParams </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HuaweiIdAuthParamsHelper</span><span class="pun">(</span><span class="typ">HuaweiIdAuthParams</span><span class="pun">.</span><span class="pln">DEFAULT_AUTH_REQUEST_PARAM</span><span class="pun">).</span><span class="pln">createParams</span><span class="pun">();</span>
    </li>
</ol></pre>
<p>
    2、调用<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-huaweiIdauthmanager">HuaweiIdAuthManager</a>的<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-huaweiIdauthmanager#getService">getService</a>方法初始化<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-huaweiIdauthservice">HuaweiIdAuthService</a>对象。
</p>
<pre class="prettyprint linenums prettyprinted" style=""><button class="pre-btn-coyp"><div>
    复制
</div></button>
<ol class="linenums">
    <li class="L0">
        <span class="typ">HuaweiIdAuthService</span><span class="pln"> service </span><span class="pun">=</span><span class="pln"> </span><span class="typ">HuaweiIdAuthManager</span><span class="pun">.</span><span class="pln">getService</span><span class="pun">(</span><span class="typ">MainActivity</span><span class="pun">.</span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> authParams</span><span class="pun">);</span>
    </li>
</ol></pre>
<p>
    3、调用<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-huaweiIdauthservice#silentSignIn">HuaweiIdAuthService.silentSignIn</a>方法发起静默登录请求。
</p>
<pre class="prettyprint linenums prettyprinted" style=""><button class="pre-btn-coyp"><div>
    复制
</div></button>
<ol class="linenums">
    <li class="L0">
        <span class="typ">Task</span><span class="pun">&lt;</span><span class="typ">AuthHuaweiId</span><span class="pun">&gt;</span><span class="pln"> task </span><span class="pun">=</span><span class="pln"> service</span><span class="pun">.</span><span class="pln">silentSignIn</span><span class="pun">();</span>
    </li>
</ol></pre>
<p>
    4、处理授权结果。<br/>如果授权成功，可获取用户的华为帐户信息，允许用户登录。
</p>
<pre class="prettyprint linenums prettyprinted" style=""><button class="pre-btn-coyp"><div>
    复制
</div></button>
<ol class="linenums">
    <li class="L0">
        <span class="pln">task</span><span class="pun">.</span><span class="pln">addOnSuccessListener</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">OnSuccessListener</span><span class="pun">&lt;</span><span class="typ">AuthHuaweiId</span><span class="pun">&gt;()</span><span class="pln"> </span><span class="pun">{</span>
    </li>
    <li class="L1">
        <span class="pln"> &nbsp; &nbsp;</span><span class="lit">@Override</span><span class="pln"> &nbsp;</span>
    </li>
    <li class="L2">
        <span class="pln"> &nbsp; &nbsp;</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onSuccess</span><span class="pun">(</span><span class="typ">AuthHuaweiId</span><span class="pln"> authHuaweiId</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> &nbsp; &nbsp; &nbsp;</span>
    </li>
    <li class="L3">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">//获取华为帐户信息 &nbsp; &nbsp; &nbsp;</span>
    </li>
    <li class="L4">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="typ">Log</span><span class="pun">.</span><span class="pln">i</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">&quot;displayName:&quot;</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> authHuaweiId</span><span class="pun">.</span><span class="pln">getDisplayName</span><span class="pun">());</span>
    </li>
    <li class="L5">
        <span class="pln"> &nbsp; &nbsp;</span><span class="pun">}</span>
    </li>
    <li class="L6">
        <span class="pun">});</span>
    </li>
</ol></pre>
<p>
    如果授权失败，可能是用户之前未进行过登录授权，应用可自行确认是否需要调用<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-huaweiIdauthservice">HuaweiIdAuthService</a>的<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-huaweiIdauthservice#getSignInIntent">getSignInIntent</a>方法显式拉起登录授权页面。
</p>
<pre class="prettyprint linenums prettyprinted" style=""><button class="pre-btn-coyp"><div>
    复制
</div></button>
<ol class="linenums">
    <li class="L0">
        <span class="pln">task</span><span class="pun">.</span><span class="pln">addOnFailureListener</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">OnFailureListener</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span>
    </li>
    <li class="L1">
        <span class="pln"> &nbsp; &nbsp;</span><span class="lit">@Override</span>
    </li>
    <li class="L2">
        <span class="pln"> &nbsp; &nbsp;</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onFailure</span><span class="pun">(</span><span class="typ">Exception</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> &nbsp; &nbsp; &nbsp;</span>
    </li>
    <li class="L3">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">//登录失败，您可以尝试使用getSignInIntent()方法显式登录</span>
    </li>
    <li class="L4">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">e instanceof </span><span class="typ">ApiException</span><span class="pun">) {</span>
    </li>
    <li class="L5">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ">ApiException</span><span class="pln"> apiException </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">ApiException</span><span class="pun">)</span><span class="pln">e</span><span class="pun">;</span>
    </li>
    <li class="L6">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">i</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">&quot;sign failed status:&quot;</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> apiException</span><span class="pun">.</span><span class="pln">getStatusCode</span><span class="pun">());</span>
    </li>
    <li class="L7">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">}</span>
    </li>
    <li class="L8">
        <span class="pln"> &nbsp; &nbsp;</span><span class="pun">}</span>
    </li>
    <li class="L9">
        <span class="pln"> </span><span class="pun">});</span>
    </li>
</ol></pre>
<h1 id="h1-1573730230709">
    5. 华为帐号取消授权
</h1>
<h2>
    5.1 场景介绍
</h2>
<p>
    为了提升应用隐私安全，应用可以提供入口，供用户取消对应用的授权。
</p>
<h2>
    5.2 业务流程
</h2>
<p>
    <img src="https://communityfile-drcn.op.hicloud.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20200117165547.78426735217426050040116160064321:20200214093207:2800:202F5FC537CE3395F5EC872CCF2905492EEED136F341889E425CA079B1C27EF4.png"/>
</p>
<p>
    1、用户在已经登录应用并授权，在应用中执行取消授权。
</p>
<p>
    2、应用调用<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-huaweiIdauthservice#cancelAuthorization">HuaweiIdAuthService.cancelAuthorization</a>方法向HUAWEI Account SDK请求取消授权。
</p>
<p>
    3、HUAWEI Account SDK清理华为帐号授权信息后向应用返回取消结果。
</p>
<h2>
    5.3 开发步骤
</h2>
<p>
    华为帐号注销授权功能涉及应用的关键开发步骤如下：
</p>
<p>
    1、应用设置取消授权入口，此部分由应用自行开发。
</p>
<p>
    2、应用调用<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-huaweiIdauthservice#cancelAuthorization">HuaweiIdAuthService.cancelAuthorization</a>方法，并处理返回结果。
</p>
<pre class="prettyprint linenums prettyprinted" style=""><button class="pre-btn-coyp"><div>
    复制
</div></button>
<ol class="linenums">
    <li class="L0">
        <span class="com">//service为登录授权时使用getService方法生成的HuaweiIdAuthService实例</span>
    </li>
    <li class="L1">
        <span class="pln">service</span><span class="pun">.</span><span class="pln">cancelAuthorization</span><span class="pun">().</span><span class="pln">addOnCompleteListener</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">OnCompleteListener</span><span class="pun">&lt;</span><span class="typ">Void</span><span class="pun">&gt;() {</span>
    </li>
    <li class="L2">
        <span class="pln"> &nbsp; &nbsp;</span><span class="lit">@Override</span>
    </li>
    <li class="L3">
        <span class="pln"> &nbsp; &nbsp;</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onComplete</span><span class="pun">(</span><span class="typ">Task</span><span class="pun">&lt;</span><span class="typ">Void</span><span class="pun">&gt;</span><span class="pln"> task</span><span class="pun">) {</span><span class="pln"> &nbsp;</span>
    </li>
    <li class="L4">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">task</span><span class="pun">.</span><span class="pln">isSuccessful</span><span class="pun">()) {</span><span class="pln"> &nbsp; </span>
    </li>
    <li class="L5">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">//取消授权成功后的处理 &nbsp; &nbsp; &nbsp;</span>
    </li>
    <li class="L6">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="typ">Log</span><span class="pun">.</span><span class="pln">i</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">&quot;onSuccess: &quot;</span><span class="pun">);</span>
    </li>
    <li class="L7">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">} </span><span class="kwd">else </span><span class="pun">{</span><span class="pln"> &nbsp; &nbsp; &nbsp; </span>
    </li>
    <li class="L8">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">//异常处理 &nbsp; &nbsp; &nbsp; </span>
    </li>
    <li class="L9">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="typ">Exception</span><span class="pln"> exception </span><span class="pun">=</span><span class="pln"> task</span><span class="pun">.</span><span class="pln">getException</span><span class="pun">();</span><span class="pln"> &nbsp; &nbsp; &nbsp; </span>
    </li>
    <li class="L0">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">exception instanceof </span><span class="typ">ApiException</span><span class="pun">){</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
    </li>
    <li class="L1">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd">int</span><span class="pln"> statusCode </span><span class="pun">=</span><span class="pln"> </span><span class="pun">((</span><span class="typ">ApiException</span><span class="pun">)</span><span class="pln"> exception</span><span class="pun">).</span><span class="pln">getStatusCode</span><span class="pun">();</span>
    </li>
    <li class="L2">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="typ">Log</span><span class="pun">.</span><span class="pln">i</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">&quot;onFailure: &quot;</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> statusCode</span><span class="pun">);</span>
    </li>
    <li class="L3">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">}</span>
    </li>
    <li class="L4">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">}</span>
    </li>
    <li class="L5">
        <span class="pln"> &nbsp; &nbsp;</span><span class="pun">}</span>
    </li>
    <li class="L6">
        <span class="pln"> </span><span class="pun">});</span>
    </li>
</ol></pre>
<h1 id="h1-1573730317319">
    6. 自动读取短信验证码
</h1>
<h2>
    6.1 场景介绍
</h2>
<p>
    验证码读取可以让您在保护用户隐私和资产安全时，快速验证用户身份，用户可以省去手动输入短信验证码的操作。
</p>
<h2>
    6.2 业务流程
</h2>
<p>
    <img src="https://communityfile-drcn.op.hicloud.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20200117165558.02206234728649345211332340102478:20200214093207:2800:0E75B8C4E5A00B1C326C29D4E8637DC7E02F822CB5182D01ED1A6DD9334C6447.png"/>
</p>
<p>
    1、用户在应用客户端需要验证手机号的界面中输入手机号，并请求获取验证码。
</p>
<p style="margin-top: 5.0px;margin-right: 0;margin-bottom: 5.0px;margin-left: 0;">
    2、应用调用<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-readsmsmanager#start">ReadSmsManager.start(Activity activity)</a>方法向HUAWEI Account SDK请求开启读取短信服务，HUAWEI Account SDK将请求发送到HUAWEI Account Server。
</p>
<p style="margin-top: 5.0px;margin-right: 0;margin-bottom: 5.0px;margin-left: 0;">
    3、HUAWEI Account Server开启读取短信服务，并通过HUAWEI Account SDK向应用客户端返回开启结果。
</p>
<p style="margin-top: 5.0px;margin-right: 0;margin-bottom: 5.0px;margin-left: 0;">
    4、应用客户端将用户手机号传递给应用服务端。
</p>
<p>
    5、应用服务端根据手机号生成短信验证码，并且按照<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-readsmsmanager#messagerule">一定格式的短信模板</a>发送短信到用户手机。
</p>
<p style="margin-top: 5.0px;margin-right: 0;margin-bottom: 5.0px;margin-left: 0;">
    6、HUAWEI Account Server监听短信，校验短信与应用客户端的匹配，将符合规则的短信通过定向广播的方式发送给应用客户端。
</p>
<p style="margin-top: 5.0px;margin-right: 0;margin-bottom: 5.0px;margin-left: 0;">
    7、应用客户端收到HUAWEI Account Server发送的定向内容，解析出短信验证码，并在应用界面中展示读取到的验证码。
</p>
<p style="margin-top: 5.0px;margin-right: 0;margin-bottom: 5.0px;margin-left: 0;">
    8、用户确认验证码无误后确认发送验证码请求。
</p>
<p style="margin-top: 5.0px;margin-right: 0;margin-bottom: 5.0px;margin-left: 0;">
    9、应用客户端将用户发送的验证码发送给应用服务端验证。
</p>
<p style="margin-top: 5.0px;margin-right: 0;margin-bottom: 5.0px;margin-left: 0;">
    10、应用服务端确认验证码无误后向应用客户端返回验证结果。
</p>
<h2>
    6.3 注意事项
</h2>
<p>
    ● &nbsp;ReadSmsManager提供了完全自动化的用户体验，但是它也要求开发者在短信消息体中设置一个自定义的hash值，如果开发者不是该消息的发送者，那么不建议使用ReadSmsManager。
</p>
<p>
    ● &nbsp;华为移动服务需要用户授予移动设备的短信读取权限。
</p>
<h2>
    6.4 开发步骤
</h2>
<p>
    自动读取短信验证码功能涉及应用的关键开发步骤如下：
</p>
<p>
    1、应用调用<a href="https://developer.huawei.com/consumer/cn/doc/development/HMS-References/account-readsmsmanager#start">ReadSmsManager.start(Activity activity)</a>方法请求开启短信读取服务。
</p>
<pre class="prettyprint linenums prettyprinted" style=""><button class="pre-btn-coyp"><div>
    复制
</div></button>
<ol class="linenums">
    <li class="L0">
        <span class="typ">Task</span><span class="pun">&lt;</span><span class="typ">Void</span><span class="pun">&gt;</span><span class="pln"> task </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ReadSmsManager</span><span class="pun">.</span><span class="pln">start</span><span class="pun">(</span><span class="typ">MainActivity.this</span><span class="pun">);</span>
    </li>
    <li class="L1">
        <span class="pln">task</span><span class="pun">.</span><span class="pln">addOnCompleteListener</span><span class="pun">(</span><span class="pln">new </span><span class="typ">OnCompleteListener</span><span class="pun">&lt;</span><span class="typ">Void</span><span class="pun">&gt;()</span><span class="pln"> </span><span class="pun">{</span>
    </li>
    <li class="L2">
        <span class="pln"> &nbsp; &nbsp;</span><span class="lit">@Override</span>
    </li>
    <li class="L3">
        <span class="pln"> &nbsp; &nbsp;public void onComplete</span><span class="pun">(</span><span class="typ">Task</span><span class="pun">&lt;</span><span class="typ">Void</span><span class="pun">&gt;</span><span class="pln"> task</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span>
    </li>
    <li class="L4">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;if </span><span class="pun">(</span><span class="pln">task</span><span class="pun">.</span><span class="pln">isSuccessful</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span>
    </li>
    <li class="L5">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">//</span><span class="pln"> </span><span class="pun">开启服务成功，可以继续后续流程</span>
    </li>
    <li class="L6">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;doSomethingWhenTaskSuccess</span><span class="pun">();</span>
    </li>
    <li class="L7">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">}</span>
    </li>
    <li class="L8">
        <span class="pln"> &nbsp; &nbsp;</span><span class="pun">}</span>
    </li>
    <li class="L9">
        <span class="pun">});</span>
    </li>
</ol></pre>
<p>
    2、应用客户端将手机号发送给应用服务端，应用服务端生成一条验证消息，并通过SMS将其发送到用户的手机号。此部分由开发者自行完成。
</p>
<p>
    3、当用户的设备接收到验证消息时，HMS会显式地向应用客户端发送广播，intent里面包含消息的文本。应用客户端可以使用广播接收此验证消息。
</p>
<pre class="prettyprint linenums prettyprinted" style=""><button class="pre-btn-coyp"><div>
    复制
</div></button>
<ol class="linenums">
    <li class="L0">
        <span class="pln">public class </span><span class="typ">MySMSBroadcastReceiver</span><span class="pln"> extends </span><span class="typ">BroadcastReceiver</span><span class="pln"> </span><span class="pun">{</span>
    </li>
    <li class="L1">
        <span class="pln"> &nbsp; &nbsp;</span><span class="lit">@Override</span>
    </li>
    <li class="L2">
        <span class="pln"> &nbsp; &nbsp;public void onReceive</span><span class="pun">(</span><span class="typ">Context</span><span class="pln"> context</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Intent</span><span class="pln"> intent</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span>
    </li>
    <li class="L3">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="typ">Bundle</span><span class="pln"> bundle </span><span class="pun">=</span><span class="pln"> intent</span><span class="pun">.</span><span class="pln">getExtras</span><span class="pun">();</span>
    </li>
    <li class="L4">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;if </span><span class="pun">(</span><span class="pln">bundle </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span>
    </li>
    <li class="L5">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="typ">Status</span><span class="pln"> status </span><span class="pun">=</span><span class="pln"> bundle</span><span class="pun">.</span><span class="pln">getParcelable</span><span class="pun">(</span><span class="typ">ReadSmsConstant</span><span class="pun">.</span><span class="pln">EXTRA_STATUS</span><span class="pun">);</span>
    </li>
    <li class="L6">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if </span><span class="pun">(</span><span class="pln">status</span><span class="pun">.</span><span class="pln">getStatusCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="typ">CommonStatusCodes</span><span class="pun">.</span><span class="pln">TIMEOUT</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span>
    </li>
    <li class="L7">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">//</span><span class="pln"> </span><span class="pun">服务已经超时，未读取到符合要求的短信，服务关闭</span>
    </li>
    <li class="L8">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;doSomethingWhenTimeOut</span><span class="pun">();</span>
    </li>
    <li class="L9">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">}</span><span class="pln"> else if </span><span class="pun">(</span><span class="pln">status</span><span class="pun">.</span><span class="pln">getStatusCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="typ">CommonStatusCodes</span><span class="pun">.</span><span class="pln">SUCCESS</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span>
    </li>
    <li class="L0">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if </span><span class="pun">(</span><span class="pln">bundle</span><span class="pun">.</span><span class="pln">containsKey</span><span class="pun">(</span><span class="typ">ReadSmsConstant</span><span class="pun">.</span><span class="pln">EXTRA_SMS_MESSAGE</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span>
    </li>
    <li class="L1">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">//</span><span class="pln"> </span><span class="pun">服务读取到了符合要求的短信，服务关闭</span>
    </li>
    <li class="L2">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;doSomethingWhenGetMessage</span><span class="pun">(</span><span class="pln">bundle</span><span class="pun">.</span><span class="pln">getString</span><span class="pun">(</span><span class="typ">ReadSmsConstant</span><span class="pun">.</span><span class="pln">EXTRA_SMS_MESSAGE</span><span class="pun">));</span>
    </li>
    <li class="L3">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">}</span>
    </li>
    <li class="L4">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">}</span>
    </li>
    <li class="L5">
        <span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">}</span>
    </li>
    <li class="L6">
        <span class="pln"> &nbsp; &nbsp;</span><span class="pun">}</span>
    </li>
    <li class="L7">
        <span class="pun">}</span>
    </li>
</ol></pre>
<p>
    应用客户端读取到验证消息的文本后，可以使用正则表达式或其他逻辑从消息中获得验证码，验证码的格式由应用客户端和服务端自行定义。
</p>
<p>
    <br/>
</p>